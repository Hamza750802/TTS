{% extends 'base.html' %}
{% block title %}API Pricing â€” Cheap TTS{% endblock %}

{% block content %}
<div style="max-width: 800px; margin: 0 auto;">
    <div style="text-align: center; margin-bottom: 40px;">
        <h1 style="font-size: 36px; margin-bottom: 12px;">ğŸ”Œ API Access</h1>
        <p style="color: #6b7280; font-size: 18px; max-width: 600px; margin: 0 auto;">
            Integrate text-to-speech into your applications.
            <br>Choose a plan and start building in minutes.
        </p>
    </div>

    <!-- What You Get -->
    <div style="background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%); border: 2px solid #10b981; border-radius: 12px; padding: 20px; margin-bottom: 30px; text-align: center;">
        <p style="color: #065f46; font-size: 15px; margin: 0;">
            <strong>âœ… Both plans include:</strong> API Keys, Embeddable Widget, Widget URL, All 500+ Voices, Multi-speaker Dialogue
        </p>
    </div>

    <!-- Pricing Cards -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 24px; margin-bottom: 40px;">
        
        <!-- Starter Plan -->
        <div style="background: white; border: 2px solid #e5e7eb; border-radius: 16px; padding: 28px; text-align: center; transition: all 0.2s ease;">
            <div style="background: #f3f4f6; color: #374151; padding: 6px 16px; border-radius: 20px; display: inline-block; font-size: 13px; font-weight: 600; margin-bottom: 16px;">STARTER</div>
            <div style="font-size: 48px; font-weight: 800; color: #1f2937; margin-bottom: 8px;">
                $9<span style="font-size: 18px; font-weight: 500; color: #6b7280;">/mo</span>
            </div>
            <p style="color: #6b7280; font-size: 14px; margin-bottom: 24px;">Perfect for side projects & MVPs</p>
            
            <ul style="text-align: left; list-style: none; padding: 0; margin: 0 0 24px 0; font-size: 14px; color: #374151;">
                <li style="padding: 10px 0; border-bottom: 1px solid #f3f4f6;">âœ… <strong>100,000</strong> characters/month</li>
                <li style="padding: 10px 0; border-bottom: 1px solid #f3f4f6;">âœ… API Key access</li>
                <li style="padding: 10px 0; border-bottom: 1px solid #f3f4f6;">âœ… Embeddable widget</li>
                <li style="padding: 10px 0; border-bottom: 1px solid #f3f4f6;">âœ… All 500+ voices</li>
                <li style="padding: 10px 0;">âœ… Email support</li>
            </ul>
            
            {% if current_user.is_authenticated %}
                {% if current_user.api_tier == 'starter' %}
                    <div class="btn" style="width: 100%; display: block; text-align: center; background: #10b981; cursor: default;">
                        âœ“ Current Plan
                    </div>
                {% else %}
                    <button onclick="subscribeAPI('api_starter')" class="btn" style="width: 100%; display: block; text-align: center;">
                        Get Starter
                    </button>
                {% endif %}
            {% else %}
                <a href="{{ url_for('signup') }}" class="btn" style="width: 100%; display: block; text-align: center;">
                    Sign Up to Get Started
                </a>
            {% endif %}
        </div>
        
        <!-- Pro Plan -->
        <div style="background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border: 2px solid #3b82f6; border-radius: 16px; padding: 28px; text-align: center; position: relative;">
            <div style="position: absolute; top: -12px; left: 50%; transform: translateX(-50%); background: linear-gradient(90deg, #3b82f6, #8b5cf6); color: white; padding: 6px 20px; border-radius: 20px; font-size: 12px; font-weight: 700;">MOST POPULAR</div>
            <div style="background: #3b82f6; color: white; padding: 6px 16px; border-radius: 20px; display: inline-block; font-size: 13px; font-weight: 600; margin-bottom: 16px; margin-top: 8px;">PRO</div>
            <div style="font-size: 48px; font-weight: 800; color: #1f2937; margin-bottom: 8px;">
                $29<span style="font-size: 18px; font-weight: 500; color: #6b7280;">/mo</span>
            </div>
            <p style="color: #6b7280; font-size: 14px; margin-bottom: 24px;">For apps with real users</p>
            
            <ul style="text-align: left; list-style: none; padding: 0; margin: 0 0 24px 0; font-size: 14px; color: #374151;">
                <li style="padding: 10px 0; border-bottom: 1px solid rgba(59,130,246,0.2);">âœ… <strong>500,000</strong> characters/month</li>
                <li style="padding: 10px 0; border-bottom: 1px solid rgba(59,130,246,0.2);">âœ… API Key access</li>
                <li style="padding: 10px 0; border-bottom: 1px solid rgba(59,130,246,0.2);">âœ… Embeddable widget</li>
                <li style="padding: 10px 0; border-bottom: 1px solid rgba(59,130,246,0.2);">âœ… All 500+ voices</li>
                <li style="padding: 10px 0;">âœ… Priority support</li>
            </ul>
            
            {% if current_user.is_authenticated %}
                {% if current_user.api_tier == 'pro' %}
                    <div class="btn primary" style="width: 100%; display: block; text-align: center; background: #10b981; cursor: default;">
                        âœ“ Current Plan
                    </div>
                {% else %}
                    <button onclick="subscribeAPI('api_pro')" class="btn primary" style="width: 100%; display: block; text-align: center;">
                        Get Pro
                    </button>
                {% endif %}
            {% else %}
                <a href="{{ url_for('signup') }}" class="btn primary" style="width: 100%; display: block; text-align: center;">
                    Sign Up to Get Started
                </a>
            {% endif %}
        </div>
        
        <!-- Enterprise/Custom Plan -->
        <div style="background: white; border: 2px solid #e5e7eb; border-radius: 16px; padding: 28px; text-align: center; transition: all 0.2s ease;">
            <div style="background: #1f2937; color: white; padding: 6px 16px; border-radius: 20px; display: inline-block; font-size: 13px; font-weight: 600; margin-bottom: 16px;">ENTERPRISE</div>
            <div style="font-size: 48px; font-weight: 800; color: #1f2937; margin-bottom: 8px;">
                Custom
            </div>
            <p style="color: #6b7280; font-size: 14px; margin-bottom: 24px;">Need more than 500K chars/month?</p>
            
            <ul style="text-align: left; list-style: none; padding: 0; margin: 0 0 24px 0; font-size: 14px; color: #374151;">
                <li style="padding: 10px 0; border-bottom: 1px solid #f3f4f6;">âœ… <strong>Unlimited</strong> characters</li>
                <li style="padding: 10px 0; border-bottom: 1px solid #f3f4f6;">âœ… Volume discounts</li>
                <li style="padding: 10px 0; border-bottom: 1px solid #f3f4f6;">âœ… Dedicated support</li>
                <li style="padding: 10px 0; border-bottom: 1px solid #f3f4f6;">âœ… Custom SLA</li>
                <li style="padding: 10px 0;">âœ… Invoice billing</li>
            </ul>
            
            <a href="mailto:sales@cheaptts.com?subject=Enterprise%20API%20Plan%20Inquiry" class="btn" style="width: 100%; display: block; text-align: center;">
                Contact Sales
            </a>
        </div>
    </div>

    <!-- Current Usage (for logged in users with API access) -->
    {% if current_user.is_authenticated and current_user.api_tier and current_user.api_tier != 'none' %}
    <div style="background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 12px; padding: 24px; margin-bottom: 30px;">
        <h3 style="margin-top: 0; margin-bottom: 16px; font-size: 18px;">ğŸ“Š Your Current Usage</h3>
        {% set limit = 100000 if current_user.api_tier == 'starter' else 500000 %}
        {% set usage = current_user.api_usage_chars or 0 %}
        {% set percent = (usage / limit * 100) | round(1) if limit > 0 else 0 %}
        <div style="margin-bottom: 12px;">
            <span style="font-weight: 600;">{{ '{:,}'.format(usage) }}</span> / {{ '{:,}'.format(limit) }} characters used
            <span style="float: right; color: {% if percent > 80 %}#ef4444{% elif percent > 50 %}#f59e0b{% else %}#10b981{% endif %};">{{ percent }}%</span>
        </div>
        <div style="background: #e5e7eb; border-radius: 8px; height: 12px; overflow: hidden;">
            <div style="background: {% if percent > 80 %}#ef4444{% elif percent > 50 %}#f59e0b{% else %}#10b981{% endif %}; height: 100%; width: {{ percent }}%; transition: width 0.3s;"></div>
        </div>
    </div>
    {% endif %}

    <!-- Simple comparison note -->
    <div style="background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 12px; padding: 20px; margin-bottom: 30px; text-align: center;">
        <p style="color: #6b7280; font-size: 14px; margin: 0;">
            <strong>ğŸ’¡ Looking to use TTS on this website instead?</strong><br>
            The <a href="{{ url_for('subscribe') if current_user.is_authenticated else url_for('signup') }}" style="color: #3b82f6;">$7.99/month web plan</a> gives you unlimited access to our online TTS tool.
        </p>
    </div>

    <!-- FAQ -->
    <div style="margin-bottom: 30px;">
        <h3 style="margin-bottom: 16px;">â“ Quick Questions</h3>
        
        <details style="background: white; border: 1px solid #e5e7eb; border-radius: 8px; padding: 16px; margin-bottom: 12px;">
            <summary style="cursor: pointer; font-weight: 600; color: #374151;">What do I get when I subscribe?</summary>
            <p style="margin-top: 12px; color: #6b7280; font-size: 14px;">Instantly! You'll get access to your API keys, embeddable widget code, and a public widget URL you can share. Start integrating TTS into your app right away.</p>
        </details>
        
        <details style="background: white; border: 1px solid #e5e7eb; border-radius: 8px; padding: 16px; margin-bottom: 12px;">
            <summary style="cursor: pointer; font-weight: 600; color: #374151;">What happens if I hit my character limit?</summary>
            <p style="margin-top: 12px; color: #6b7280; font-size: 14px;">API calls will return an error. You can upgrade to Pro for 5x more characters, or wait for your limit to reset next month.</p>
        </details>
        
        <details style="background: white; border: 1px solid #e5e7eb; border-radius: 8px; padding: 16px; margin-bottom: 12px;">
            <summary style="cursor: pointer; font-weight: 600; color: #374151;">Can I cancel anytime?</summary>
            <p style="margin-top: 12px; color: #6b7280; font-size: 14px;">Yes! Cancel anytime from your account settings. No questions asked.</p>
        </details>
    </div>

    <!-- CTA for logged-in users without API -->
    {% if current_user.is_authenticated and (not current_user.api_tier or current_user.api_tier == 'none') %}
    <div style="text-align: center; padding: 30px; background: linear-gradient(135deg, #eff6ff 0%, #f5f3ff 100%); border-radius: 16px; border: 1px solid #e5e7eb;">
        <h3 style="margin-top: 0;">ğŸš€ Ready to build?</h3>
        <p style="color: #6b7280; margin-bottom: 20px;">Choose a plan above and get your API keys in seconds.</p>
    </div>
    {% endif %}
</div>

<script>
function subscribeAPI(planType) {
    fetch('/create-checkout-session', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ plan_type: planType })
    })
    .then(response => response.json())
    .then(data => {
        if (data.url) {
            window.location.href = data.url;
        } else if (data.error) {
            alert('Error: ' + data.error);
        }
    })
    .catch(error => {
        alert('Something went wrong. Please try again.');
        console.error('Error:', error);
    });
}
</script>
{% endblock %}
