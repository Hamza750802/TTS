<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cheap TTS Widget</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .widget {
            background: white;
            border-radius: 16px;
            padding: 30px;
            max-width: 600px;
            margin: 0 auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 24px;
            text-align: center;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            color: #555;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        textarea, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.3s;
        }
        
        textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        select {
            cursor: pointer;
            background: white;
        }
        
        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
        }
        
        .control-group label {
            font-size: 12px;
            margin-bottom: 5px;
        }
        
        .control-group input {
            padding: 8px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 13px;
        }
        
        .control-group input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .audio-player {
            margin-top: 20px;
            width: 100%;
            display: none;
        }
        
        .audio-player.show {
            display: block;
        }
        
        .error, .success {
            padding: 12px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
        }
        
        .error {
            background: #fef2f2;
            border: 1px solid #ef4444;
            color: #dc2626;
        }
        
        .success {
            background: #ecfdf5;
            border: 1px solid #10b981;
            color: #059669;
        }
        
        .error.show, .success.show {
            display: block;
        }
        
        .loading {
            text-align: center;
            color: #667eea;
            font-weight: 600;
            display: none;
        }
        
        .loading.show {
            display: block;
        }
        
        .powered-by {
            text-align: center;
            margin-top: 20px;
            font-size: 12px;
            color: #999;
        }
        
        .powered-by a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="widget">
        <h2>üé§ Text to Speech</h2>
        
        <div class="form-group">
            <label for="text">Enter Text:</label>
            <textarea id="text" placeholder="Type or paste your text here...">Hello! Welcome to our text to speech service.</textarea>
        </div>
        
        <div class="form-group">
            <label for="voice">Select Voice:</label>
            <select id="voice">
                <option value="">Loading voices...</option>
            </select>
        </div>
        
        <div class="controls">
            <div class="control-group">
                <label for="rate">Speed:</label>
                <input type="text" id="rate" value="+0%" placeholder="+0%">
            </div>
            <div class="control-group">
                <label for="volume">Volume:</label>
                <input type="text" id="volume" value="+0%" placeholder="+0%">
            </div>
            <div class="control-group">
                <label for="pitch">Pitch:</label>
                <input type="text" id="pitch" value="+0Hz" placeholder="+0Hz">
            </div>
        </div>
        
        <button id="generateBtn" onclick="generateSpeech()">üéµ Generate Speech</button>
        
        <div class="loading" id="loading">Generating speech...</div>
        <div class="error" id="error"></div>
        <div class="success" id="success"></div>
        
        <audio id="audioPlayer" class="audio-player" controls></audio>
        
        <div class="powered-by">
            Powered by <a href="https://cheaptts.com" target="_blank">CheapTTS</a>
        </div>
    </div>
    
    <script>
        const API_KEY = "{{ api_key }}";
        let allVoices = [];
        
        // Load voices on page load
        window.addEventListener('DOMContentLoaded', loadVoices);
        
        async function loadVoices() {
            try {
                const response = await fetch('https://cheaptts.com/api/voices');
                const data = await response.json();
                
                if (data.success && data.voices) {
                    allVoices = data.voices;
                    const voiceSelect = document.getElementById('voice');
                    voiceSelect.innerHTML = '';
                    
                    // Group by language
                    const grouped = {};
                    data.voices.forEach(v => {
                        const lang = v.locale.split('-')[0].toUpperCase();
                        if (!grouped[lang]) grouped[lang] = [];
                        grouped[lang].push(v);
                    });
                    
                    // Add voices grouped by language
                    Object.keys(grouped).sort().forEach(lang => {
                        const optgroup = document.createElement('optgroup');
                        optgroup.label = `${lang} (${grouped[lang].length} voices)`;
                        
                        grouped[lang].forEach(voice => {
                            const option = document.createElement('option');
                            option.value = voice.shortName;
                            option.textContent = `${voice.localName} (${voice.gender}) - ${voice.locale}`;
                            optgroup.appendChild(option);
                        });
                        
                        voiceSelect.appendChild(optgroup);
                    });
                    
                    // Set default
                    voiceSelect.value = 'en-US-AriaNeural';
                }
            } catch (error) {
                showError('Failed to load voices: ' + error.message);
            }
        }
        
        async function generateSpeech() {
            const text = document.getElementById('text').value.trim();
            const voice = document.getElementById('voice').value;
            const rate = document.getElementById('rate').value || '+0%';
            const volume = document.getElementById('volume').value || '+0%';
            const pitch = document.getElementById('pitch').value || '+0Hz';
            
            if (!text) {
                showError('Please enter some text!');
                return;
            }
            
            if (!voice) {
                showError('Please select a voice!');
                return;
            }
            
            // Hide previous messages
            hideMessages();
            
            // Show loading
            const loading = document.getElementById('loading');
            const btn = document.getElementById('generateBtn');
            loading.classList.add('show');
            btn.disabled = true;
            btn.textContent = 'Generating...';
            
            try {
                const response = await fetch('https://cheaptts.com/api/v1/synthesize', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-API-Key': API_KEY
                    },
                    body: JSON.stringify({
                        text: text,
                        voice: voice,
                        rate: rate,
                        volume: volume,
                        pitch: pitch
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showSuccess('Speech generated successfully!');
                    
                    // Show and play audio
                    const audio = document.getElementById('audioPlayer');
                    audio.src = data.audio_url;
                    audio.classList.add('show');
                    audio.play();
                } else {
                    showError(data.error || 'Failed to generate speech');
                }
            } catch (error) {
                showError('Error: ' + error.message);
            } finally {
                loading.classList.remove('show');
                btn.disabled = false;
                btn.textContent = 'üéµ Generate Speech';
            }
        }
        
        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = '‚ùå ' + message;
            errorDiv.classList.add('show');
        }
        
        function showSuccess(message) {
            const successDiv = document.getElementById('success');
            successDiv.textContent = '‚úÖ ' + message;
            successDiv.classList.add('show');
        }
        
        function hideMessages() {
            document.getElementById('error').classList.remove('show');
            document.getElementById('success').classList.remove('show');
        }
    </script>
</body>
</html>
